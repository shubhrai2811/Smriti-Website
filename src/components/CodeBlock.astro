---
interface Props {
  code: string;
  lang?: string;
}

const { code, lang = 'bash' } = Astro.props;
const id = `code-${Math.random().toString(36).slice(2, 9)}`;
---

<div class="code-block group">
  <button
    class="copy-btn absolute top-3 right-3 p-2 rounded-lg opacity-0 group-hover:opacity-100 transition-opacity cursor-pointer"
    data-code={code}
    data-id={id}
    aria-label="Copy to clipboard"
  >
    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z" />
    </svg>
  </button>
  <pre id={id}><code>{code}</code></pre>
</div>

<style>
  .copy-btn {
    background: rgba(255, 255, 255, 0.1);
    color: #94a3b8;
  }
  .copy-btn:hover {
    background: rgba(255, 255, 255, 0.2);
    color: #e2e8f0;
  }
  [data-theme="light"] .copy-btn {
    background: rgba(0, 0, 0, 0.05);
    color: #64748b;
  }
  [data-theme="light"] .copy-btn:hover {
    background: rgba(0, 0, 0, 0.1);
    color: #1e293b;
  }
  pre {
    margin: 0;
    white-space: pre-wrap;
    word-break: break-all;
  }
</style>

<script is:inline>
  document.addEventListener('click', (e) => {
    const btn = e.target.closest('.copy-btn');
    if (!btn) return;
    const code = btn.getAttribute('data-code');
    navigator.clipboard.writeText(code).then(() => {
      const svg = btn.querySelector('svg');
      const original = svg.innerHTML;
      svg.innerHTML = '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />';
      setTimeout(() => { svg.innerHTML = original; }, 2000);
    });
  });
</script>
